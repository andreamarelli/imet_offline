!function(e){var t={};function a(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(o,r,function(t){return e[t]}.bind(null,r));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/",a(a.s=2)}({2:function(e,t,a){e.exports=a("dyb5")},"8jQw":function(e,t){function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],o=!0,r=!1,n=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(e){r=!0,n=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw n}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,o=new Array(t);a<t;a++)o[a]=e[a];return o}e.exports={tileSize:1024,internalTileSize:1024,mapbox_vector_layer:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"fill",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return{id:t,type:o,source:n||e.exports.mapbox_vector_source(t),"source-layer":n||t,paint:r,label:a}},mapbox_vector_source:function(e){return{type:"vector",tiles:[window.Laravel.baseUrl+window.urls.ofac_tiles+e+"/{z}/{x}/{y}.pbf"]}},mapbox_wms_source:function(t,a,o){return{type:"raster",tiles:[(t=t.replace(/\??$/,"?"))+"service=WMS&version=1.1.1&request=GetMap&format=image/png&transparent=true&styles=&layers="+a+"&width="+(o=o||e.exports.tileSize)+"&height="+o+"&bbox={bbox-epsg-3857}&srs=EPSG:3857"],tileSize:o}},wms:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=!0===r?window.urls.ofac_mapproxy:window.urls.ofac_mapserver;i=i.replace(/\??$/,"?");var s={id:t,type:"raster",source:e.exports.mapbox_wms_source(i,t,e.exports.internalTileSize),label:o};if(!_.isEmpty(n))for(var l=0,c=Object.entries(n);l<c.length;l++){var p=a(c[l],2),u=p[0],d=p[1];s[u]=d}return s}}},aIQs:function(e,t,a){"use strict";t.a={props:{red_yellow_green:{type:Array,default:function(){return["#ce2e29","#f9c74f","#007233"]}},rainbow_10:{type:Array,default:function(){return["#404887","#3374ff","#43aa8b","#90be6d","#f9c74f","#f3722c","#f94144","#d35e9d","#ad7af6","#e7c1cb","#c9bcb5","#5f6269"]}}},methods:{generateGradientPalette:function(e,t){return t=t||this.red_yellow_green,gradstop({stops:e,inputFormat:"hex",colorArray:t})},generateColorPalette:function(e,t){return(t=t||this.rainbow_10).slice(0,e)}}}},bmAP:function(e,t){e.exports={comifac:window.WebMapping.Mapbox.wms("comifac",Locale.getLabel("mapping.layers.comifac"),!0,{attribution:'<div style="width: 800px;"><b>Image source de base :</b> Verhegghen, A., Mayaux, P., de Wasseige, C., and Defourny, P.: Mapping Congo Basin vegetation types from 300 m and 1 km multi-sensor time series for carbon stocks and forest areas estimation, Biogeosciences, 9, 5061-5079, doi:10.5194/bg-9-5061-2012, 2012. <a target="_blank" href="http://www.biogeosciences.net/9/5061/2012/bg-9-5061-2012.html">biogeosciences.net</a><br/><b>Données sources ajoutées :</b> SRTM de la Nasa, OSM et OFAC<br/><b>Traitée :</b> Mai 2015, <a target="_blank" href="/docs/atlas/mapsteps.pdf">Etapes de réalisation</a></div>'}),spotvgt:window.WebMapping.Mapbox.wms("spotvgt",Locale.getLabel("mapping.layers.spotvgt"),!0),modis:window.WebMapping.Mapbox.wms("modis",Locale.getLabel("mapping.layers.modis"),!0),srtm:window.WebMapping.Mapbox.wms("srtm",Locale.getLabel("mapping.layers.srtm"),!0),glc2000:window.WebMapping.Mapbox.wms("glc2000",Locale.getLabel("mapping.layers.glc2000"),!0),congo_basin_vegetation_map:window.WebMapping.Mapbox.wms("congo_basin_vegetation_map",Locale.getLabel("mapping.layers.congo_basin_vegetation_map"),!0),total_carbon:window.WebMapping.Mapbox.wms("total_carbon",Locale.getLabel("mapping.layers.total_carbon"),!0),land_fragmentation:{id:"land_fragmentation",type:"raster",source:window.WebMapping.Mapbox.mapbox_wms_source("https://geospatial.jrc.ec.europa.eu/geoserver/dopa_explorer_3/wms?","land_fragmentation"),label:"Fragmentation des terres",abstract:"&copy; Services DOPA"},land_degradation:{id:"land_degradation",type:"raster",source:window.WebMapping.Mapbox.mapbox_wms_source("https://geospatial.jrc.ec.europa.eu/geoserver/dopa_explorer_3/wms?","LPD"),label:"Dégradation des terres",abstract:"&copy; Services DOPA"},soil_organic_carbon:{id:"soil_organic_carbon",type:"raster",source:window.WebMapping.Mapbox.mapbox_wms_source("https://geospatial.jrc.ec.europa.eu/geoserver/dopa_explorer_3/wms?","soil_organic_carbon"),label:"Carbone organique du sol",abstract:"&copy; Services DOPA"},above_ground_carbon:{id:"above_ground_carbon",type:"raster",source:window.WebMapping.Mapbox.mapbox_wms_source("https://geospatial.jrc.ec.europa.eu/geoserver/dopa_explorer_3/wms?","above_ground_carbon"),label:"Carbon au-dessous du sol",abstract:"&copy; Services DOPA"},tree_cover:{id:"tree_cover",type:"raster",source:window.WebMapping.Mapbox.mapbox_wms_source("http://50.18.182.188:6080/arcgis/services/TreeCover2000/ImageServer/WMSServer?",0),label:"Tree Cover (2000-2010)",abstract:encodeURI('Hansen, M. C., P. V. Potapov, R. Moore, M. Hancher, S. A. Turubanova, A. Tyukavina, D. Thau, S. V. Stehman, S. J. Goetz, T. R. Loveland, A. Kommareddy, A. Egorov, L. Chini, C. O. Justice, and J. R. G. Townshend. 2013. <b>“High-Resolution Global Maps of 21st-Century Forest Cover Change.”</b> Science 342 (15 November): 850–53. Data available on-line from: <a href="https://glad.umd.edu/dataset/global-2010-tree-cover-30-m" target="_blank">https://glad.umd.edu/dataset/global-2010-tree-cover-30-m</a>. Accessed through <a href="https://www.globalforestwatch.org" target="_blank">Global Forest Watch</a>')},intact_forest:{id:"intact_forest",type:"raster",source:{type:"raster",tiles:["https://storage.googleapis.com/earthenginepartners-hansen/tiles/intact_forest_2016/{z}/{x}/{y}.png"],attribution:'Map tiles by <a target="_top" rel="noopener" href="http://stamen.com">Stamen Design</a>, under <a target="_top" rel="noopener" href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a target="_top" rel="noopener" href="http://openstreetmap.org">OpenStreetMap</a>, under <a target="_top" rel="noopener" href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>'},label:"Intact Forest Landscapes (IFL 2000-2016)",abstract:encodeURI('Greenpeace, University of Maryland, World Resources Institute and Transparent World. “Intact Forest Landscapes. 2000/2013/2016” Accessed through <a href="https://www.globalforestwatch.org" target="_blank">Global Forest Watch</a>')},comifac_mask:window.WebMapping.Mapbox.wms("comifac_mask",null,!0),comifac_eez:window.WebMapping.Mapbox.mapbox_vector_layer("comifac_eez",null,"fill",{"fill-color":["case",["boolean",["feature-state","hover"],!1],"rgba(255, 255, 255, 0.3)","rgba(255, 255, 255, 0)"],"fill-outline-color":"rgba(60, 150, 255, 0.8)"}),countries:window.WebMapping.Mapbox.mapbox_vector_layer("countries",null,"fill",{"fill-color":["case",["boolean",["feature-state","hover"],!1],"rgba(255, 255, 255, 0.3)","rgba(255, 255, 255, 0)"],"fill-outline-color":"rgba(0, 50, 0, 0.8)"},"countries"),landscapes:window.WebMapping.Mapbox.mapbox_vector_layer("landscapes",Locale.getLabel("mapping.platform.sites.landscapes",2),"fill",{"fill-color":"rgb(255, 255, 0)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.5]}),klc:window.WebMapping.Mapbox.mapbox_vector_layer("klc",Locale.getLabel("mapping.platform.sites.klc",2),"fill",{"fill-color":"rgb(255, 155, 0)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.5]}),concessions:window.WebMapping.Mapbox.mapbox_vector_layer("concessions",Locale.getLabel("mapping.platform.sites.concessions",2),"fill",{"fill-color":"rgb(163, 113, 66)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.5]}),protected_areas:window.WebMapping.Mapbox.mapbox_vector_layer("protected_areas",Locale.getLabel("mapping.platform.sites.protected_areas",2),"fill",{"fill-color":"rgb(0, 115, 40)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.5]},"protected_areas")}},dyb5:function(e,t,a){window.mapbox_access_token="pk.eyJ1IjoiYW5kcmVhbWFyZWxsaWRldiIsImEiOiJjamF2Y3VzNGU2cWoxMnFud3E3NzByaWs1In0.bnMeWpZrxYbq0xb_fuOy6Q",window.urls=window.urls||{},window.urls.ofac_mapserver="https://www.observatoire-comifac.net/geo/mapserver/ofacgeo.php?",window.urls.ofac_mapproxy="https://www.observatoire-comifac.net/mapproxy/service",window.urls.ofac_tiles="tiles/",window.urls.dopa_geoserver="https://geospatial.jrc.ec.europa.eu/geoserver/dopa_explorer_3/wms",window.WebMapping={},window.WebMapping.Leaflet=a("izcT"),window.WebMapping.Leaflet.Layers=a("rgVn"),window.WebMapping.Mapbox=a("8jQw"),window.WebMapping.Mapbox.Layers=a("bmAP"),a("o5qL")},gulh:function(e,t,a){"use strict";function o(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return r(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,o=new Array(t);a<t;a++)o[a]=e[a];return o}t.a={props:{opacity:{type:Number,default:.6}},methods:{__normalize:function(e,t){if(t=t||Math.max.apply(Math,o(e)),!isNaN(t)&&t>0){var a=t/100;e=e.map((function(e){return Math.round(e/a)}))}return e},__classify:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,a=function(e){return function(t){if(null===t)return null;for(var a=0,o=0;o<100;){if(t>o&&t<=o+100/e)return a;o+=100/e,a++}return 0}};return e.map(a(t))},choropleth:function(e,t){var a=[],o=[];return Object.entries(e).forEach((function(e){a.push(e[0]),o.push(e[1])})),o=this.__normalize(o),o=this.__classify(o,t.length),e=_.zipObject(a,o)}}}},izcT:function(e,t){function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],o=!0,r=!1,n=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(e){r=!0,n=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw n}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,o=new Array(t);a<t;a++)o[a]=e[a];return o}e.exports={tileSize:1024,mapproxy_wms:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this,n={layers:e,format:"image/png",transparent:!0,tileSize:r.tileSize,label:t};if(!_.isEmpty(o))for(var i=0,s=Object.entries(o);i<s.length;i++){var l=a(s[i],2),c=l[0],p=l[1];n[c]=p}return window.Leaflet.tileLayer.wms(window.urls.ofac_mapproxy,n)},vector_tiles:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=window.Leaflet.latLngBounds(window.Leaflet.latLng(-11.125875,5.566434),window.Leaflet.latLng(17.936017,30.83715));return window.Leaflet.vectorGrid.protobuf("https://h03-stg-ofac.jrc.it/tiles/"+e+"/{z}/{x}/{y}.pbf",{vectorTileLayerStyles:{protected_area:{color:"#ff6666",opacity:.6,weight:2,fillColor:"#ffaaaa",fillOpacity:.6,fill:!0}},bounds:a,key:"protected_area",id:"protected_area",label:t})},mapserver_wms:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this,n={layers:e,format:"image/png",transparent:!0,tileSize:r.tileSize,label:t};if(!_.isEmpty(o))for(var i=0,s=Object.entries(o);i<s.length;i++){var l=a(s[i],2),c=l[0],p=l[1];n[c]=p}return window.Leaflet.tileLayer.wms(window.urls.ofac_mapserver,n)},mapbox_layer:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e="satellite"===(e="light"===(e="streets"===e?"streets-v11":e)?"light-v10":e)?"satellite-v9":e;return window.Leaflet.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token="+window.mapbox_access_token,{tileSize:512,maxZoom:18,zoomOffset:-1,id:"mapbox/"+e,attribution:'Map data &copy; <a target="_blank" href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a target="_blank" href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a target="_blank" href="http://mapbox.com">Mapbox</a>',label:t})},project_markerCluster:function(e,t){var o=window.Leaflet.markerClusterGroup({iconCreateFunction:function(e){return new window.Leaflet.DivIcon({html:'<div><span class="marker-count">'+e.getChildCount()+"</span></div>",className:"marker-cluster",iconSize:new window.Leaflet.Point(40,40)})},showCoverageOnHover:!1,zoomToBoundsOnClick:!1,label:t});return e.forEach((function(e){var t=a(e,5),r=t[0],n=t[1],i=t[2],s=t[3],l=t[4],c="lightgray";"finished"===l?c="red":"ongoing"===l?c="green":"planned"===l&&(c="orange");var p=window.Leaflet.marker(new window.Leaflet.LatLng(r,n),{title:s,icon:window.Leaflet.AwesomeMarkers.icon({markerColor:c,prefix:"fa",icon:"asterisk",iconColor:"white"})});p.bindPopup(i),o.addLayer(p)})),o},getLayersForLeaftletControl:function(e){var t={};return e.forEach((function(e){t[e.options.label]=e})),t}}},o5qL:function(e,t,a){"use strict";a.r(t);var o={data:function(){return{api_library_cancel_token:null,library:{data:null,count:null,show:!1,loading:!1,show_filters:!1,filter_domain:null}}},computed:{filtered_library:function(){var e=this,t=this.library.data;return t=(t=_.orderBy(t,"title","asc")).filter((function(t){return null===e.library.filter_domain||""===e.library.filter_domain||t.domains.includes(e.library.filter_domain)}))}},methods:{refreshLibrary:function(){var e=this;this.library.loading=!1,this.library.data=null,this.library.count=null,this.library.show=null,null!==this.api_library_cancel_token&&this.api_library_cancel_token(),null!==this.theme&&("regional"===this.level||"national"===this.level&&null!==this.site||"concessions"===this.level&&null!==this.site||"protected_areas"===this.level&&null!==this.site)&&(this.library.loading=!0,window.axios({method:"post",url:window.Laravel.baseUrl+"api/analysis/library",data:{_token:e.csrf,level:e.level,site:e.site||null,domain:e.theme||null},cancelToken:new window.axios.CancelToken((function(t){e.api_library_cancel_token=t}))}).then((function(t){console.log("Request to library API executed"),_.isEmpty(t.data)?e.library.count=0:(e.library.data="string"==typeof t.data?JSON.parse(t.data):t.data,e.library.count=e.library.data.length)})).catch((function(e){window.axios.isCancel(e)?console.log("Request to library API canceled. No more necessary"):console.log(e)})).finally((function(){e.library.loading=!1,e.api_library_cancel_token=null})))}}},r={data:function(){return{api_projects_cancel_token:null,projects:{data:null,count:null,show:!1,loading:!1,show_filters:!1,filter_domain:null,filter_status:null}}},computed:{filtered_projects:function(){var e=this,t=this.projects.data;return t=(t=_.orderBy(t,"Acronym","asc")).filter((function(t){return null!==e.projects.filter_domain&&""!==e.projects.filter_domain?t.domains.includes(e.projects.filter_domain):null===e.projects.filter_status||""===e.projects.filter_status||t.status.includes(e.projects.filter_status)}))}},methods:{refreshProjects:function(){var e=this;this.projects.loading=null,this.projects.data=null,this.projects.count=null,this.projects.show=null,null!==this.api_projects_cancel_token&&this.api_projects_cancel_token(),null!==this.theme&&("regional"===this.level||"national"===this.level&&null!==this.site||"concessions"===this.level&&null!==this.site||"protected_areas"===this.level&&null!==this.site)&&(this.projects.loading=!0,window.axios({method:"post",url:window.Laravel.baseUrl+"api/analysis/projects",data:{_token:e.csrf,level:e.level,site:e.site||null,domain:e.theme||null},cancelToken:new window.axios.CancelToken((function(t){e.api_projects_cancel_token=t}))}).then((function(t){console.log("Request to projects API executed"),_.isEmpty(t.data)?e.projects.count=0:(e.projects.data="string"==typeof t.data?JSON.parse(t.data):t.data,e.projects.count=e.projects.data.length)})).catch((function(e){window.axios.isCancel(e)?console.log("Request to projects API canceled. No more necessary"):console.log(e)})).finally((function(){e.projects.loading=!1,e.api_projects_cancel_token=null})))}}},n={data:function(){return{api_cancel_token:null,api_loading:!1,card_has_data:!1,api_data:{forest_management:{regional:null,national:null,concessions:null},biodiversity:{regional:null,national:null,protected_areas:null}},visible_hidden_components:[]}},mounted:function(){var e=this;window.vueBus.$on("toggle_hidden_component",(function(t){e.toggle_hidden_component(t)}))},methods:{toggle_hidden_component:function(e){this.visible_hidden_components.includes(e)?this.visible_hidden_components.splice(this.visible_hidden_components.indexOf(e),1):this.visible_hidden_components.push(e)},is_hidden_component_visible:function(e){return this.visible_hidden_components.includes(e)},getCachedData:function(){if("local"!==this.level){if("regional"===this.level)return this.api_data[this.theme][this.level];if(null!==this.site&&null!==this.api_data[this.theme][this.level]&&this.api_data[this.theme][this.level].hasOwnProperty(this.site))return this.api_data[this.theme][this.level][this.site]}return null},getDataAttribute:function(e){var t=this.getCachedData();if(null!==t){return function(e,t){for(var a=t.split("."),o=e,r=0;r<a.length;++r){if(!o.hasOwnProperty(a[r]))return null;o=o[a[r]]}return o}(t,e)}return null},getAPI:function(e){var t=this;this.site=e||null,this.api_loading=!0,this.card_has_data=!1,this.selected_card=this.theme+"_"+this.level,this.visible_hidden_components=[];var a="regional"===this.level?"api/analysis/"+this.theme+"/"+this.level:"api/analysis/"+this.theme+"/"+this.level+"/"+e;this.__retrieveAPI(a,(function(a){"regional"===t.level?t.api_data[t.theme][t.level]=a:(t.api_data[t.theme][t.level]=t.api_data[t.theme][t.level]||{},t.api_data[t.theme][t.level][e]=a),Vue.nextTick((function(){t.selected_card=t.theme+"_"+t.level,t.card_has_data=!0,Vue.nextTick((function(){var e=document.querySelectorAll(".card-api.card-"+t.theme+"_"+t.level+" .selection:first-of-type")[0];e&&(t.selected_card_button=e.getAttribute("data-card-key"))}))}))}))},__retrieveAPI:function(e,t){var a=this;null!==this.api_cancel_token&&this.api_cancel_token();var o=this.getCachedData();if(null!==o)return console.log("Request to API not executed. Data retrieved from cache."),t(JSON.parse(JSON.stringify(o))),void this.finallyCallback();window.axios({method:"post",url:window.Laravel.baseUrl+e,data:{_token:a.csrf},cancelToken:new window.axios.CancelToken((function(e){a.api_cancel_token=e}))}).then((function(e){console.log("Request to API executed"),t(e.data)})).catch((function(e){window.axios.isCancel(e)?console.log("Request to API canceled. No more necessary",e.message):console.log(e)})).finally((function(){a.finallyCallback()}))},finallyCallback:function(){this.api_cancel_token=null,this.api_loading=!1,this.removeLayerPopup()}}},i=a("aIQs"),s=a("gulh"),l={data:function(){return{hover_feature:[],popup:null,popup_features:[],click_coords:null}},methods:{setHighlight:function(e,t,a,o){this.layerIsOnMap(e)?t?(this.addGrayedLayer(e),this.map.setFilter(e,["==",a,o]),this.map.setFilter(this.__grayedLayerId(e),["!=",a,o])):(this.removeGrayedLayer(e),this.map.setFilter(e,!0)):this.removeGrayedLayer(e)},__grayedLayerId:function(e){return e+"_grayed"},addGrayedLayer:function(e){this.layerIsOnMap(this.__grayedLayerId(e))||this.map.addLayer({id:this.__grayedLayerId(e),type:"fill",source:e,"source-layer":e,paint:{"fill-color":"rgba(180, 180, 180, 0.5)"}})},removeGrayedLayer:function(e){this.layerIsOnMap(this.__grayedLayerId(e))&&this.map.removeLayer(this.__grayedLayerId(e))},setMask:function(e,t,a,o){this.layerIsOnMap(e)&&null!==o&&t?(this.addMaskedLayer(e),this.map.setFilter(this.__maskedLayerId(e),["!=",a,o])):this.removeMaskedLayer(e)},__maskedLayerId:function(e){return e+"_masked"},addMaskedLayer:function(e){this.layerIsOnMap(this.__maskedLayerId(e))||this.map.addLayer({id:this.__maskedLayerId(e),type:"fill",source:e,"source-layer":e,paint:{"fill-color":"rgba(0, 0, 0, 0.5)","fill-outline-color":"rgba(0, 0, 0, 0.5)"}})},removeMaskedLayer:function(e){this.layerIsOnMap(this.__maskedLayerId(e))&&this.map.removeLayer(this.__maskedLayerId(e))},mouseOver:function(e){var t=this;t.layerIsOnMap(e)&&(t.hover_feature[e]=t.hover_feature[e]||[],this.map.on("mousemove",e,(function(a){t.hover_feature[e].includes(a.features[0].id)||(t.hover_feature[e].forEach((function(a){t._featureHoverOff(e,a)})),t._featureHoverOn(e,a.features[0].id))})),this.map.on("mouseleave",e,(function(){t.hover_feature[e].forEach((function(a){t._featureHoverOff(e,a)}))})))},__setFeatureHover:function(e,t,a){this.map.setFeatureState({source:t,sourceLayer:t,id:e},{hover:a})},_featureHoverOn:function(e,t){this.hover_feature[e].push(t),this.__setFeatureHover(t,e,!0),this.map.getCanvas().style.cursor="pointer"},_featureHoverOff:function(e,t){this.hover_feature[e].includes(t)&&(this.__setFeatureHover(t,e,!1),this.map.getCanvas().style.cursor="",this.hover_feature[e].splice(this.hover_feature[e].indexOf(t),1))},hoverOnRelatedLayer:function(e,t,a,o){var r=this;r.layerIsOnMap(e)&&r.layerIsOnMap(t)&&(r.hover_feature[e]=r.hover_feature[e]||[],r.hover_feature[t]=r.hover_feature[t]||[],this.map.on("mousemove",e,(function(e){var n=r.map.querySourceFeatures(t,{sourceLayer:t,filter:["==",o,e.features[0].properties[a]]}).map((function(e){return e.id}));r.hover_feature[t].forEach((function(e){n.includes(e)||r._featureHoverOff(t,e)})),n.forEach((function(e){r.hover_feature[t].includes(e)||r._featureHoverOn(t,e)}))})),this.map.on("mouseleave",e,(function(){r.hover_feature[t].forEach((function(e){r._featureHoverOff(t,e)}))})))},showPopup:function(e){var t=this;t.layerIsOnMap(e)&&t.map.on("click",e,(function(e){t.removeLayerPopup(e),t.click_coords=e.lngLat,e.features.forEach((function(e){t.popup_features.map((function(e){return e.id})).includes(e.id)||t.popup_features.push(e)}));var a="";t.popup_features.forEach((function(e,o){a+='<div class="popup-item" id="popup-item_'+o+'">'+t.featurePopupDescription(e)+t.featurePopupActions(e)+"</div>"})),t.popup=(new window.mapboxgl.Popup).setLngLat(e.lngLat).setHTML(a).addTo(t.map),document.querySelectorAll(".mapboxgl-popup .popup-item").forEach((function(e){var a=e.id.replace("popup-item_",""),o=e.querySelector("button.getAPI");null!==o&&o.addEventListener("click",(function(e){var o=t.popup_features[a];t.zoomToFeature(o),t.getAPI(o.id)}))}))}))},removeLayerPopup:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!==this.popup&&this.popup.remove(),this.popup=null,(null===e||null!=this.click_coords&&this.click_coords!==e.lngLat)&&(this.popup_features=[])},featurePopupDescription:function(e){return"countries"===e.layer.id?"<i>"+this.Locale.getLabel("mapping.platform.sites.countries",1)+'</i><br /><b class="green">'+e.properties.name_fr+"</b>":"<i>"+this.Locale.getLabel("mapping.platform.sites."+e.layer.id,1)+'</i><br /><b class="green">'+e.properties.name+"</b>"},featurePopupActions:function(e){return e.layer.id===this.level?'<div class="popup-footer"><button class="btn btn-sm act-btn-basic getAPI">'+this.Locale.getLabel("mapping.platform.analysis")+"</button></div>":""}}},c={mounted:function(){var e=this;window.vueBus.$on("toggleDataLayer",(function(t,a,o,r){e.toggle(t,a,o,r)}))},methods:{toggle:function(e,t,a,o){e?this.map.addLayer({id:t,type:"fill",source:a,"source-layer":a,paint:o}):this.map.removeLayer(t)}}};window.WebMapping.Mapbox.Platform=Vue.extend({mixins:[o,r,n,i.a,l,c,s.a],created:function(){this.theme=""===this.theme?null:this.theme,this.level=""===this.level?null:this.level,this.site=""===this.site?null:this.site},data:function(){return{map:null,extents:null,Locale:window.Locale,csrf:window.Laravel.csrfToken,zoomBBoxPadding:75,layers:{backgrounds:{comifac:window.WebMapping.Mapbox.Layers.comifac,spotvgt:window.WebMapping.Mapbox.Layers.spotvgt,modis:window.WebMapping.Mapbox.Layers.modis,srtm:window.WebMapping.Mapbox.Layers.srtm,glc2000:window.WebMapping.Mapbox.Layers.glc2000,congo_basin_vegetation_map:window.WebMapping.Mapbox.Layers.congo_basin_vegetation_map,total_carbon:window.WebMapping.Mapbox.Layers.total_carbon},dopa_resources:{land_fragmentation:window.WebMapping.Mapbox.Layers.land_fragmentation,land_degradation:window.WebMapping.Mapbox.Layers.land_degradation,soil_organic_carbon:window.WebMapping.Mapbox.Layers.soil_organic_carbon,above_ground_carbon:window.WebMapping.Mapbox.Layers.above_ground_carbon},external_resources:{tree_cover:window.WebMapping.Mapbox.Layers.tree_cover,intact_forest:window.WebMapping.Mapbox.Layers.intact_forest},overlays:{comifac_mask:window.WebMapping.Mapbox.Layers.comifac_mask,comifac_eez:window.WebMapping.Mapbox.Layers.comifac_eez,countries:window.WebMapping.Mapbox.Layers.countries,landscapes:window.WebMapping.Mapbox.Layers.landscapes,klc:window.WebMapping.Mapbox.Layers.klc,concessions:window.WebMapping.Mapbox.Layers.concessions,protected_areas:window.WebMapping.Mapbox.Layers.protected_areas}},mask_applied:!1,map_loading:!1,show_layer_selector:!1,selected_card:!1,selected_card_button:null}},watch:{theme:function(){this.reset(),this.level=null,this.site=null,this.refreshLibrary(),this.refreshProjects()},level:function(){this.site=null,this.reset(),this.zoomToBBox(),this.refreshInteractiveLayers(),this.refreshLibrary(),this.refreshProjects(),"regional"===this.level&&this.getAPI(),"concessions"!==this.level&&"protected_areas"!==this.level||this.addLayer(this.level,"overlays")},site:function(e){this.reset(),this.zoomToBBox(),this.refreshInteractiveLayers(),this.refreshLibrary(),this.refreshProjects(),"national"!==this.level&&null===this.site||this.getAPI(this.site)}},mounted:function(){this.initMap(),this.refreshLibrary(),this.refreshProjects(),this.map_loading=!1,this.api_loading=!1},methods:{setLoading:function(){var e=this;this.map.on("dataloading",(function(){e.map_loading=!0})),this.map.on("data",(function(){e.map.areTilesLoaded()&&(e.map_loading=!1)})),this.map.on("error",(function(){e.map_loading=!1}))},reset:function(){this.show_layer_selector=!1,this.removeLayerPopup(),this.selected_card=null,this.selected_card_button=null},initMap:function(){var e=this;this.map=new window.mapboxgl.Map({container:"platform_map",style:"mapbox://styles/mapbox/streets-v11",bounds:this.__getBounds(this.extents.comifac),minZoom:3,maxZoom:12}),this.map.addControl(new window.mapboxgl.NavigationControl({showCompass:!1}),"top-right"),this.map.on("click",(function(t){e.show_layer_selector=!1})),this.setLoading(),this.map.on("load",(function(){e.map.addSource("countries",window.WebMapping.Mapbox.mapbox_vector_source("countries")),e.map.addSource("protected_areas",window.WebMapping.Mapbox.mapbox_vector_source("protected_areas")),e.addLayer("comifac_mask","overlays"),e.addLayer("comifac_eez","overlays"),e.addLayer("countries","overlays")}))},layerIsOnMap:function(e){return null!==this.map&&void 0!==this.map.getLayer(e)},addLayer:function(e,t){this.layerIsOnMap(e)||(this.map.addLayer(this.layers[t][e]),window.vueBus.$emit("toggle_layer",e,!0),this.refreshInteractiveLayers(),this.sortLayers())},removeLayer:function(e,t){this.layerIsOnMap(e)&&(this.map.removeLayer(e),window.vueBus.$emit("toggle_layer",e,!1),this.refreshInteractiveLayers(),"countries"!==e&&"protected_areas"!==e&&this.map.removeSource(e),this.sortLayers())},toggleLayer:function(e,t){this.layerIsOnMap(e)?this.removeLayer(e,t):this.addLayer(e,t)},sortLayers:function(){for(var e in this.layerIsOnMap("countries")&&this.map.moveLayer("countries"),this.layerIsOnMap("comifac_eez")&&this.map.moveLayer("comifac_eez"),this.layers)if(this.layers.hasOwnProperty(e))for(var t in this.layers[e])this.layers[e].hasOwnProperty(t)&&(this.layerIsOnMap(t)&&this.map.moveLayer(t),this.layerIsOnMap(this.__grayedLayerId(t))&&this.map.moveLayer(this.__grayedLayerId(t)),this.layerIsOnMap(this.__maskedLayerId(t))&&this.map.moveLayer(this.__maskedLayerId(t)));this.layerIsOnMap("countries_mask")&&this.map.moveLayer("countries_mask")},__getBounds:function(e){return new window.mapboxgl.LngLatBounds(new window.mapboxgl.LngLat(e.minx,e.miny),new window.mapboxgl.LngLat(e.maxx,e.maxy))},zoomToBBox:function(){"regional"===this.level?this.map.fitBounds(this.__getBounds(this.extents.comifac),{padding:this.zoomBBoxPadding}):"national"===this.level&&null!==this.site&&this.map.fitBounds(this.__getBounds(this.extents[this.level][this.site]),{padding:this.zoomBBoxPadding})},zoomToFeature:function(e){var t=window.Turf.bbox({type:"FeatureCollection",features:[e]});this.map.fitBounds(t,{padding:this.zoomBBoxPadding})},refreshInteractiveLayers:function(){this.showPopup("countries"),this.mouseOver("countries"),this.hoverOnRelatedLayer("countries","comifac_eez","iso3","ISO_Ter1"),this.setMask("countries","national"===this.level&&null!==this.site,"iso3",this.site),this.mouseOver("comifac_eez"),this.hoverOnRelatedLayer("comifac_eez","countries","ISO_Ter1","iso3"),this.setMask("comifac_eez","national"===this.level&&null!==this.site,"ISO_Ter1",this.site),this.showPopup("landscapes"),this.mouseOver("landscapes"),this.showPopup("klc"),this.mouseOver("klc"),this.showPopup("protected_areas"),this.mouseOver("protected_areas"),this.setHighlight("protected_areas","national"===this.level&&null!==this.site,"country",this.site),this.showPopup("concessions"),this.mouseOver("concessions"),this.setHighlight("concessions","national"===this.level&&null!==this.site,"country",this.site)},toggleLayersSelector:function(){this.show_layer_selector=!this.show_layer_selector,this.show_layer_selector&&(this.library.show=!1,this.projects.show=!1)},toggleLibrary:function(){this.library.show=!this.library.show,this.library.show&&(this.show_layer_selector=!1,this.projects.show=!1)},toggleProjects:function(){this.projects.show=!this.projects.show,this.projects.show&&(this.show_layer_selector=!1,this.library.show=!1)},showCardButton:function(e){this.library.show=!1,this.projects.show=!1,null!==this.selected_card_button&&$(".collapse").collapse("hide"),this.selected_card_button!==e?this.selected_card_button=e:this.selected_card_button=null}}})},rgVn:function(e,t){e.exports={mapbox_streets:window.WebMapping.Leaflet.mapbox_layer("streets",Locale.getLabel("mapping.layers.mapbox_streets")),mapbox_light:window.WebMapping.Leaflet.mapbox_layer("light",Locale.getLabel("mapping.layers.mapbox_light")),mapbox_satellite:window.WebMapping.Leaflet.mapbox_layer("satellite",Locale.getLabel("mapping.layers.mapbox_satellite")),comifac:window.WebMapping.Leaflet.mapproxy_wms("comifac",Locale.getLabel("mapping.layers.comifac"),{attribution:'<div style="width: 800px;"><b>Image source de base :</b> Verhegghen, A., Mayaux, P., de Wasseige, C., and Defourny, P.: Mapping Congo Basin vegetation types from 300 m and 1 km multi-sensor time series for carbon stocks and forest areas estimation, Biogeosciences, 9, 5061-5079, doi:10.5194/bg-9-5061-2012, 2012. <a target="_blank" href="http://www.biogeosciences.net/9/5061/2012/bg-9-5061-2012.html">biogeosciences.net</a><br/><b>Données sources ajoutées :</b> SRTM de la Nasa, OSM et OFAC<br/><b>Traitée :</b> Mai 2015, <a target="_blank" href="/docs/atlas/mapsteps.pdf">Etapes de réalisation</a></div>'}),spotvgt:window.WebMapping.Leaflet.mapproxy_wms("spotvgt",Locale.getLabel("mapping.layers.spotvgt")),modis:window.WebMapping.Leaflet.mapproxy_wms("modis",Locale.getLabel("mapping.layers.modis")),srtm:window.WebMapping.Leaflet.mapproxy_wms("srtm",Locale.getLabel("mapping.layers.srtm")),glc2000:window.WebMapping.Leaflet.mapproxy_wms("glc2000",Locale.getLabel("mapping.layers.glc2000")),congo_basin_vegetation_map:window.WebMapping.Leaflet.mapproxy_wms("congo_basin_vegetation_map",Locale.getLabel("mapping.layers.congo_basin_vegetation_map")),total_carbon:window.WebMapping.Leaflet.mapproxy_wms("total_carbon",Locale.getLabel("mapping.layers.total_carbon")),tree_cover:window.Leaflet.tileLayer.wms("http://50.18.182.188:6080/arcgis/services/TreeCover2000/ImageServer/WMSServer?",{layers:"0",format:"image/png",transparent:!0,attribution:'Hansen/UMD/Google/USGS/NASA, Accessed through <a href="https://www.globalforestwatch.org" target="_blank">Global Forest Watch</a>',label:"Tree Cover (2000-2010)",abstract:encodeURI('Hansen, M. C., P. V. Potapov, R. Moore, M. Hancher, S. A. Turubanova, A. Tyukavina, D. Thau, S. V. Stehman, S. J. Goetz, T. R. Loveland, A. Kommareddy, A. Egorov, L. Chini, C. O. Justice, and J. R. G. Townshend. 2013. <b>“High-Resolution Global Maps of 21st-Century Forest Cover Change.”</b> Science 342 (15 November): 850–53. Data available on-line from: <a href="https://glad.umd.edu/dataset/global-2010-tree-cover-30-m" target="_blank">https://glad.umd.edu/dataset/global-2010-tree-cover-30-m</a>. Accessed through <a href="https://www.globalforestwatch.org" target="_blank">Global Forest Watch</a>')}),intact_forest:window.Leaflet.tileLayer("https://storage.googleapis.com/earthenginepartners-hansen/tiles/intact_forest_2016/{z}/{x}/{y}.png?",{attribution:'<a href="http://www.intactforests.org" target="_blank">Intact Forest Landscape (IFL)</a>',label:"Intact Forest Landscapes (IFL 2000-2016)",abstract:encodeURI('Greenpeace, University of Maryland, World Resources Institute and Transparent World. “Intact Forest Landscapes. 2000/2013/2016” Accessed through <a href="https://www.globalforestwatch.org" target="_blank">Global Forest Watch</a>')}),borders:window.WebMapping.Leaflet.mapserver_wms("borders",null,{}),landscapes:window.WebMapping.Leaflet.mapproxy_wms("landscapes",Locale.getLabel("entities.landscape",2)),klc:window.WebMapping.Leaflet.mapproxy_wms("klc",Locale.getLabel("entities.klc",2)),concessions:window.WebMapping.Leaflet.mapserver_wms("concessions",Locale.getLabel("form/concession.concession",2)),protected_areas:window.WebMapping.Leaflet.mapproxy_wms("protected_areas",Locale.getLabel("form/protected_area.protected_area",2))}}});
//# sourceMappingURL=mapping.js.map